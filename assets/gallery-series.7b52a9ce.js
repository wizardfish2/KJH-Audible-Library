import{_ as x}from"./gallery-lazy.bcb33703.js";import{a as B}from"./gallery-search.5e488d70.js";import{f as M}from"./gallery-findSubPageSource.b5dbe77b.js";import{_ as D,c as g,b,a as f,F as N,j as w,g as k,d as h,i as R,r as F,o as m,e as T,k as v,t as y,h as O,n as $}from"./lodash.21348ef7.js";import"./gallery.0e89d352.js";import"./gallery-makeCoverUrl.8378190f.js";import"./content-script-helpers.e49fc91b.js";import"./jquery.050764e9.js";import"./howler.22814ddb.js";import"./index.abab9d81.js";import"./tippy.f48e1c74.js";import"./vue.runtime.esm-bundler.a995c875.js";import"./gallery-page-title.2c997460.js";import"./gallery-timeStringToSeconds.9aa0cb6a.js";const P={name:"aleSeries",mixins:[M],data:function(){return{collectionSource:"pageCollection",pageTitle:"Series",pageSubTitle:null,listReady:!1}},computed:{optionsOpenMargin:function(){return this.$store.state.searchOptOpenHeight?{marginBottom:0}:!1},galleryStyle:function(){return this.$store.state.searchOptOpenHeight?{overflow:"hidden",height:this.$store.state.searchOptOpenHeight-this.$refs.wrapper.offsetTop*2+"px"}:!1}},methods:{makeCollection:function(){const r=this;let t=[],e=1,i=this.$store.state.library.series;_.eachRight(r.subPageSource.collection,function(s){s.series&&_.each(s.series,function(a){const n=_.find(t,{asin:a.asin});let l=i?_.find(i,{asin:a.asin}):!1,d,c,o;if(n)n.books.push(s.title||s.shortTitle),r.subPageSource.library&&(n.minRating=_.min([n.minRating,s.myRating].map(_.toNumber).filter(u=>!_.isNaN(u))),n.allBooksMinusDupes=l.allBooksMinusDupes,n.missingLatest=o!==c);else{r.subPageSource.library&&(l.allBooksMinusDupes=r.removeDuplicates(l.allBooks),d=l.allBooksMinusDupes.filter(p=>l.books.some(S=>S===p.asin)),c=_.max(l.allBooksMinusDupes.map(p=>_.toNumber(p.bookNumbers))),o=_.max(d.map(p=>_.toNumber(p.bookNumbers))));const u={name:a.name,asin:a.asin,added:e,books:[s.title||s.shortTitle],authors:s.authors,narrators:s.narrators,publishers:s.publishers};r.subPageSource.library&&!!l?(++e,u.minRating=_.toNumber(s.myRating),u.allBooksMinusDupes=l.allBooksMinusDupes,u.missingLatest=o!==c,t.push(u)):r.subPageSource.wishlist&&(++e,t.push(u))}})}),_.reverse(t),this.$store.commit("prop",{key:"pageCollection",value:t}),this.updateListRenderingOptions(),this.listReady=!0},updateListRenderingOptions:function(){let r=this,t={scope:[{active:!0,key:"name",tippy:"Search series by name",weight:5},{active:!0,key:"books",tippy:"Search series by book titles",weight:1},{active:!0,key:"authors.name",tippy:"Search series by authors",weight:1},{active:!0,key:"narrators.name",tippy:"Search series by narrators",weight:1},{active:!0,key:"publishers.name",tippy:"Search series by publishers",weight:1}],filter:[{active:!1,type:"filterExtras",label:"Number of books",key:"inSeries",range:[1,function(){let e=_.get(r.$store.state,r.collectionSource),i=_.maxBy(e,function(s){if(s.books)return s.books.length});return i?i.books.length:1}()],rangeMinDist:0,rangeSuffix:"",rangeMin:function(){return 1},rangeMax:function(){let e=_.get(r.$store.state,r.collectionSource),i=_.maxBy(e,function(s){if(s.books)return s.books.length});return i?i.books.length:1},condition:function(e){if(e.books){let i=this.range[0],s=this.range[1];return e.books.length>=i&&e.books.length<=s}}},{excludeFromWishlist:!0,type:"divider",key:"divider1.0"},{excludeFromWishlist:!0,active:!1,type:"filterExtras",label:"Rating (min)",tippy:"Based on the book you rated lowest in the series",key:"min-rating",condition:function(e){return(e.minRating||0)>=this.range[0]},range:!0,rangeMin:()=>1,rangeMax:()=>5,rangeMinDist:0,rangeSuffix:"",tooltipFormatter:function(e){switch(e){case 1:return e+" (Not for me)";case 2:return e+" (It\u2019s okay)";case 3:return e+" (Pretty good)";case 4:return e+" (It\u2019s great)";case 5:return e+" (I love it)";default:return 0}}},{excludeFromWishlist:!0,type:"divider",key:"divider1.1"},{excludeFromWishlist:!0,active:!1,type:"filterExtras",label:"Incomplete series",key:"series-incomplete",tippy:"Series where I don't own all the books",condition:function(e){return e.allBooksMinusDupes.length>e.books.length}},{excludeFromWishlist:!0,type:"divider",key:"divider1.2"},{excludeFromWishlist:!0,active:!1,type:"filterExtras",label:"Missing latest book",key:"missing-latest",condition:function(e){return e.missingLatest&&e.allBooksMinusDupes.length>e.books.length}}],sort:[{active:!1,key:"randomize",label:"Randomize",type:"sortExtras",tippy:"Ignores sorting and randomizes instead unless there's an active search."},{type:"divider",key:"divider1"},{active:!0,current:!0,key:"added",label:"Added",type:"sort",tippy:'<div style="text-align: left;"><small>&#9650;</small> Old at the top <br><small style="display: inline-block; transform: rotate(180deg);">&#9650;</small> New at the top</div>'},{active:!0,current:!1,key:"name",label:"Name",type:"sort",tippy:"Sort by series name"},{active:!1,current:!1,key:"amount",label:"Number of books",type:"sort"},{excludeFromWishlist:!0,active:!1,current:!1,key:"amountTotal",label:"Total number of books",type:"sort"},{excludeFromWishlist:!0,active:!1,current:!1,key:"missing",label:"Missing",tippy:"Number of missing books",type:"sort"}]};this.subPageSource.wishlist&&(t.filter=_.filter(t.filter,function(e){return!e.excludeFromWishlist}),t.sort=_.filter(t.sort,function(e){return!e.excludeFromWishlist})),this.$setListRenderingOpts(t)},removeDuplicates:function(r){let t=_.clone(r);var e=0;return _.each(t,function(i){i.order=++e}),t=_.groupBy(t,"bookNumbers"),_.each(t,function(i,s){if(i.length===1)t[s]=[i[0]];else{var a=_.filter(i,function(n){return!n.notInLibrary});a.length>0?t[s]=a:t[s]=[i[0]]}}),t=_.map(t,function(i){return i}),t=_.flatten(t),t=_.orderBy(t,"order","asc"),t}}},W={key:0,class:"books-total",content:"Total number of books I have in this series."},C={key:0};function I(r,t,e,i,s,a){const n=B,l=R("router-link"),d=x,c=F("tippy");return r.listReady?(m(),g("div",{key:0,id:"ale-series",class:"box-layout-wrapper",style:k(a.optionsOpenMargin),ref:"wrapper"},[b(n,{collectionSource:r.collectionSource,pageTitle:r.pageTitle,pageSubTitle:r.pageSubTitle},null,8,["collectionSource","pageTitle","pageSubTitle"]),f("div",{style:k(a.galleryStyle),class:"page-content"},[(m(!0),g(N,null,w(r.$store.getters.collection,(o,u)=>(m(),T(d,{class:"single-box","data-asin":o.asin,key:"series:"+o.asin},{default:v(()=>[b(l,{to:{name:"series",params:{series:o.asin},query:{subPageSource:r.subPageSource.name}}},{default:v(()=>[f("h2",null,y(o.name),1),o.books&&o.books.length?O((m(),g("div",W,[f("span",{class:$({"my-books":o.allBooksMinusDupes&&o.allBooksMinusDupes.length})},y(o.books.length),3),o.allBooksMinusDupes&&o.allBooksMinusDupes.length?(m(),g("span",C,"\xA0of\xA0"+y(o.allBooksMinusDupes.length),1)):h("",!0)])),[[c,{placement:"right"}]]):h("",!0)]),_:2},1032,["to"])]),_:2},1032,["data-asin"]))),128))],4)],4)):h("",!0)}var Y=D(P,[["render",I],["__scopeId","data-v-28d8ba39"]]);export{Y as default};
