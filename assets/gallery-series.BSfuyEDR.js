import{_ as S}from"./gallery-lazy.D_imdb33.js";import{a as B}from"./gallery-search.DaLOcaib.js";import{f as M}from"./gallery-findSubPageSource.Bbd9uvvg.js";import{_ as w,c as p,b as f,o as c,d as b,a as g,F as N,i as D,n as k,e as R,r as F,h as O,j as v,w as $,t as h,g as W}from"./lodash.DACQP5Pu.js";import"./gallery.D2do1gyG.js";import"./gallery-makeCoverUrl.zIZ8I3-C.js";import"./jquery.TLgHKWof.js";import"./index.D8jzMlQu.js";import"./content-script-helpers.DqBukurb.js";import"./jszip.Ip5JjwIA.js";import"./howler.DKQBfetK.js";import"./tippy.CrdWBEYJ.js";import"./gallery-page-title.CSSwydTm.js";import"./fuse.esm.BiDyM4rQ.js";const C={name:"aleSeries",mixins:[M],data:function(){return{collectionSource:"pageCollection",pageTitle:"Series",pageSubTitle:null,listReady:!1}},computed:{optionsOpenMargin:function(){return this.$store.state.searchOptOpenHeight?{marginBottom:0}:!1},galleryStyle:function(){return this.$store.state.searchOptOpenHeight?{overflow:"hidden",height:this.$store.state.searchOptOpenHeight-this.$refs.wrapper.offsetTop*2+"px"}:!1}},methods:{makeCollection:function(){const i=this,t=[];let e=1;_.eachRight(i.subPageSource.collection,s=>{_.each(_.get(s,"series"),r=>{const l=_.find(t,{asin:r.asin}),a=_.find(this.$store.state.library.series,{asin:r.asin}),n=l??{books:[],added:e++,name:r.name,asin:r.asin,authors:s.authors,narrators:s.narrators,publishers:s.publishers,minRating:_.toNumber(s.myRating)};if(a){let m=function(u){return(u||"").split("-").map(_.toNumber).filter(_.isFinite)},d=function(u){return _.flatMap(u.map(x=>m(x.bookNumbers)))},o=function(u){return _.max(d(u))};a.allBooksMinusDupes=i.removeDuplicates(a.allBooks);const y=_.filter(a.allBooksMinusDupes,u=>_.includes(a.books,u.asin));n.allBooksMinusDupes=a.allBooksMinusDupes,n.myMaxBookNumber=o(y),n.maxBookNumber=o(a.allBooksMinusDupes),n.missingLatest=n.myMaxBookNumber<n.maxBookNumber,n.minRating=this.calcMinRating(n,s)}n.books.push(s.title||s.shortTitle),l||t.push(n)})}),_.reverse(t),this.$store.commit("prop",{key:"pageCollection",value:t}),this.updateListRenderingOptions(),this.listReady=!0},updateListRenderingOptions:function(){let i=this,t={scope:[{active:!0,key:"name",tippy:"Search series by name",weight:5},{active:!0,key:"books",tippy:"Search series by book titles",weight:1},{active:!0,key:"authors.name",tippy:"Search series by authors",weight:1},{active:!0,key:"narrators.name",tippy:"Search series by narrators",weight:1},{active:!0,key:"publishers.name",tippy:"Search series by publishers",weight:1}],filter:[{active:!1,type:"filterExtras",label:"Number of owned books",key:"inSeries",range:[1,function(){let e=_.get(i.$store.state,i.collectionSource),s=_.maxBy(e,function(r){if(r.books)return r.books.length});return s?s.books.length:1}()],rangeMinDist:0,rangeSuffix:"",rangeMin:function(){return 1},rangeMax:function(){let e=_.get(i.$store.state,i.collectionSource),s=_.maxBy(e,function(r){if(r.books)return r.books.length});return s?s.books.length:1},condition:function(e){if(e.books){let s=this.range[0],r=this.range[1];return e.books.length>=s&&e.books.length<=r}}},{excludeFromWishlist:!0,type:"divider",key:"divider1.0"},{excludeFromWishlist:!0,active:!1,type:"filterExtras",label:"Rating (min)",tippy:"Based on the book you rated lowest in the series",key:"min-rating",condition:function(e){return(e.minRating||0)>=this.range[0]},range:!0,rangeMin:()=>1,rangeMax:()=>5,rangeMinDist:0,rangeSuffix:"",tooltipFormatter:function(e){switch(e){case 1:return e+" (Not for me)";case 2:return e+" (It’s okay)";case 3:return e+" (Pretty good)";case 4:return e+" (It’s great)";case 5:return e+" (I love it)";default:return 0}}},{excludeFromWishlist:!0,type:"divider",key:"divider1.1"},{excludeFromWishlist:!0,active:!1,type:"filterExtras",label:"Incomplete series",key:"series-incomplete",tippy:"Series in which I don't own all the books",condition:function(e){return e.allBooksMinusDupes.length>e.books.length}},{excludeFromWishlist:!0,type:"divider",key:"divider1.2"},{excludeFromWishlist:!0,active:!1,type:"filterExtras",label:"Missing latest book",key:"missing-latest",condition:e=>e?.missingLatest}],sort:[{active:!1,key:"randomize",label:"Randomize",type:"sortExtras",tippy:"Ignores sorting and randomizes instead unless there's an active search."},{type:"divider",key:"divider1"},{active:!0,current:!0,key:"added",label:"Added",type:"sort",tippy:'<div style="text-align: left;"><small>&#9650;</small> Old at the top <br><small style="display: inline-block; transform: rotate(180deg);">&#9650;</small> New at the top</div>'},{active:!0,current:!1,key:"name",label:"Name",type:"sort",tippy:"Sort by series name"},{active:!1,current:!1,key:"amount",label:"Number of owned books",type:"sort"},{excludeFromWishlist:!0,active:!1,current:!1,key:"amountTotal",label:"Total number of books",type:"sort"},{excludeFromWishlist:!0,active:!1,current:!1,key:"missing",label:"Missing",tippy:"Number of missing books",type:"sort"}]};this.subPageSource.wishlist&&(t.filter=_.filter(t.filter,function(e){return!e.excludeFromWishlist}),t.sort=_.filter(t.sort,function(e){return!e.excludeFromWishlist})),this.$setListRenderingOpts(t)},removeDuplicates:function(i){let t=_.clone(i);var e=0;return _.each(t,function(s){s.order=++e}),t=_.groupBy(t,"bookNumbers"),_.each(t,function(s,r){if(s.length===1)t[r]=[s[0]];else{var l=_.filter(s,function(a){return!a.notInLibrary});l.length>0?t[r]=l:t[r]=[s[0]]}}),t=_.map(t,function(s){return s}),t=_.flatten(t),t=_.orderBy(t,"order","asc"),t},calcMinRating(i,t){let e=[i.minRating,t.myRating];return e=_.map(e,_.toNumber),e=_.filter(e,_.isFinite),_.min(e)}}},I={key:0,class:"books-total",content:"Total number of books I have in this series."},T={key:0};function z(i,t,e,s,r,l){const a=B,n=R("router-link"),m=S,d=F("tippy");return i.listReady?(c(),p("div",{key:0,id:"ale-series",class:"box-layout-wrapper",style:k(l.optionsOpenMargin),ref:"wrapper"},[b(a,{collectionSource:i.collectionSource},null,8,["collectionSource"]),g("div",{style:k(l.galleryStyle),class:"page-content"},[(c(!0),p(N,null,D(i.$store.getters.collection,(o,y)=>(c(),O(m,{class:"single-box","data-asin":o.asin,key:"series:"+o.asin},{default:v(()=>[b(n,{to:{name:"series",params:{series:o.asin},query:{subPageSource:i.subPageSource.name}}},{default:v(()=>[g("h2",null,h(o.name),1),o.books&&o.books.length?$((c(),p("div",I,[g("span",{class:W({"my-books":o.allBooksMinusDupes&&o.allBooksMinusDupes.length})},h(o.books.length),3),o.allBooksMinusDupes&&o.allBooksMinusDupes.length?(c(),p("span",T," of "+h(o.allBooksMinusDupes.length),1)):f("",!0)])),[[d,{placement:"right"}]]):f("",!0)]),_:2},1032,["to"])]),_:2},1032,["data-asin"]))),128))],4)],4)):f("",!0)}const Y=w(C,[["render",z],["__scopeId","data-v-c08e84b7"]]);export{Y as default};
