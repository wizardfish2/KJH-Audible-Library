import{m as $,o,c as a,a as b,_ as S,r as w,u as k,t as h,h as d,F as v,i as C,d as T,j as f,e as g,f as O,b as M,w as x}from"./lodash.4793ee9f.js";import{c as B}from"./gallery.f59fb107.js";import{m as G}from"./gallery-makeCoverUrl.52ce2441.js";import{f as q,_ as R}from"./gallery-findSubPageSource.85dad557.js";import{_ as j}from"./gallery-page-title.3a2b50a5.js";import"./jquery.fca3dd19.js";import"./index.ff69ba6a.js";import"./content-script-helpers.caeeb6e9.js";import"./jszip.f74de32f.js";import"./howler.45f3c8a6.js";import"./tippy.0141f121.js";const z={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function H(e,t){return o(),a("svg",z,t[0]||(t[0]=[b("path",{fill:"currentColor",d:"M7.41 8.58L12 13.17l4.59-4.59L18 10l-6 6l-6-6z"},null,-1)]))}const N=$({name:"mdi-chevron-down",render:H}),V={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function D(e,t){return o(),a("svg",V,t[0]||(t[0]=[b("path",{fill:"currentColor",d:"M8.59 16.58L13.17 12L8.59 7.41L10 6l6 6l-6 6z"},null,-1)]))}const E=$({name:"mdi-chevron-right",render:D});const U={props:["parent","books","subPageSource","parentCategoryIndex"],data(){return{showTags:!1,tagGroups:[]}},watch:{showTags(e){let t=this.getOpenTags();_.remove(t,s=>s==this.parentCategoryIndex),e&&(t=t.concat([this.parentCategoryIndex])),this.$updateQueries({tagsOpen:t.join(",")})}},created(){let e=this.getOpenTags();this.showTags=_.includes(e,_.toString(this.parentCategoryIndex)),this.getTagGroups()},methods:{getOpenTags(){let e=this.$route.query.tagsOpen||"";return e=e.split(","),e=_.compact(e),e},getTagGroups(){let e=[];this.books.filter(u=>_.first(u.tags)).forEach(u=>{e=e.concat(u.tags)});let s=_.groupBy(e,"name");s=_.map(s,u=>({name:_.get(u,"0.name"),length:u.length})),s=_.map(s,u=>({name:u.name,length:u.length})),s=_.sortBy(s,"name"),this.tagGroups=s}}},F={key:0,class:"category-tags"},Q={key:0,class:"number-of-books"};function W(e,t,s,u,r,c){const l=E,i=N,y=w("router-link");return r.tagGroups.length?(o(),a("div",{key:0,class:O(["category-tags-wrapper",{"tags-open":r.showTags,"tags-closed":!r.showTags}])},[b("div",{class:"tags-toggle-btn",onClick:t[0]||(t[0]=m=>r.showTags=!r.showTags)},[k(" Tags ("+h(r.tagGroups.length)+") ",1),r.showTags?(o(),d(i,{key:1})):(o(),d(l,{key:0}))]),r.showTags?(o(),a("div",F,[(o(!0),a(v,null,C(r.tagGroups,m=>(o(),a("div",{class:"category-tag",key:m.name},[T(y,{to:{name:"category",params:{parent:s.parent.slug},query:{subPageSource:s.subPageSource.name,filterExtras:encodeURIComponent(`tags:${m.name}`),tagTitle:m.name}}},{default:f(()=>[k(h(m.name),1)]),_:2},1032,["to"]),m.length?(o(),a("span",Q,"\xA0("+h(m.length)+")",1)):g("",!0)]))),128))])):g("",!0)],2)):g("",!0)}const A=S(U,[["render",W],["__scopeId","data-v-7aa5605d"]]);const J={mixins:[B,G],props:["parent","book","subPageSource"],data(){return{coversMax:5}},computed:{randomBooks(){let e=_.filter(this.parent.books,function(t){return _.first(t.categories)&&t.cover});return _.sampleSize(e,this.coversMax)}}},K={key:0,class:"sample-covers"},X=["src"];function Y(e,t,s,u,r,c){const l=w("router-link");return s.parent&&s.parent.books?(o(),a("div",K,[(o(!0),a(v,null,C(c.randomBooks,(i,y)=>(o(),a("div",{class:"sample-cover",key:i.asin},[T(l,{to:{name:"category",params:{parent:i.categories[0]?e.slugify(i.categories[0].name):null,child:i.categories[1]?e.slugify(i.categories[1].name):null},query:{book:i.asin,subPageSource:s.subPageSource.name}}},{default:f(()=>[b("img",{crossorigin:"anonymous",src:e.makeCoverUrl(i.cover),alt:""},null,8,X)]),_:2},1032,["to"])]))),128))])):g("",!0)}const Z=S(J,[["render",Y],["__scopeId","data-v-8d33429a"]]);const ee={name:"aleCategories",mixins:[B,q],data:function(){return{categories:null,listReady:!1,pageTitle:"Categories",pageSubTitle:null}},methods:{makeCollection:function(){const e=this;let t={};t.parent=[],_.each(e.subPageSource.collection,function(s,u){if(s.categories){const r=_.get(s,"categories[0].name");let c=_.find(t.parent,["name",r]);c||(c=t.parent.push({name:r,slug:e.slugify(r),books:[]})),c=_.find(t.parent,["name",r]),c.books.push(s);const l=_.get(s,"categories[1].name");if(l){c.sub||(c.sub=[]);let i=_.find(c.sub,["name",l]);i||(i=c.sub.push({name:l,slug:e.slugify(l),books:[]})),i=_.find(c.sub,["name",l]),i.books.push(s)}}}),t.parent=_.orderBy(t.parent,"name","asc"),_.each(t.parent,function(s,u){s.sub=_.orderBy(s.sub,"name","asc")}),this.categories=t.parent,this.$store.commit("prop",{key:"pageCollection",value:[]}),this.$store.commit("prop",{key:"mutatingCollection",value:[]}),this.listReady=!0}}},te={key:0,id:"ale-categories",class:"box-layout-wrapper"},oe=["data-category"],se={key:1},ne=["innerHTML"],ae=["innerHTML"],re={key:2,class:"child-categories"},ie={key:1},ue={key:2,class:"number-of-books"};function ce(e,t,s,u,r,c){const l=j,i=R,y=w("router-link"),m=Z,I=A,P=M("tippy");return e.listReady?(o(),a("div",te,[T(l),T(i),(o(!0),a(v,null,C(e.categories,(n,L)=>(o(),a("div",{class:"single-box","data-category":n.name,key:n.name},[b("h2",null,[n.slug?(o(),d(y,{key:0,to:{name:"category",params:{parent:n.slug,child:void 0},query:{subPageSource:e.subPageSource.name}}},{default:f(()=>[k(h(n.name),1)]),_:2},1032,["to"])):(o(),a("span",se,h(n.name),1))]),n.slug?(o(),d(y,{key:0,class:"books-total",to:{name:"category",params:{parent:n.slug,child:void 0},query:{subPageSource:e.subPageSource.name}}},{default:f(()=>[n.books?x((o(),a("div",{key:0,innerHTML:n.books.length,content:"Total number of books in this category."},null,8,ne)),[[P,{placement:"right"}]]):g("",!0)]),_:2},1032,["to"])):n.books?x((o(),a("div",{key:1,innerHTML:n.books.length,content:"Total number of books in this category."},null,8,ae)),[[P,{placement:"right"}]]):g("",!0),n.sub?(o(),a("div",re,[(o(!0),a(v,null,C(n.sub,(p,le)=>(o(),a("div",{key:p.name},[n&&n.slug&&p&&p.slug?(o(),d(y,{key:0,to:{name:"category",params:{parent:n.slug,child:p.slug},query:{subPageSource:e.subPageSource.name}}},{default:f(()=>[k(h(p.name),1)]),_:2},1032,["to"])):(o(),a("span",ie)),p.books?(o(),a("span",ue,"\xA0("+h(p.books.length)+")",1)):g("",!0)]))),128))])):g("",!0),n&&n.books?(o(),d(m,{key:3,parent:n,books:n.books,subPageSource:e.subPageSource},null,8,["parent","books","subPageSource"])):g("",!0),n.books?(o(),d(I,{key:4,parent:n,books:n.books,subPageSource:e.subPageSource,parentCategoryIndex:L},null,8,["parent","books","subPageSource","parentCategoryIndex"])):g("",!0)],8,oe))),128))])):g("",!0)}const Ce=S(ee,[["render",ce],["__scopeId","data-v-0f088f81"]]);export{Ce as default};
